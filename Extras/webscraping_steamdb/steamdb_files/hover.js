(function(){"use strict";const ne=!!document.querySelector(".header-user-avatar")?175:300,H=new Map,i=document.getElementById("js-hover");if(!i)return;const W=".app";let T=null,d=null,L=null,v=null,E=null,Y=!0,b=null,m=null;const u=document.querySelector("#js-screenshots"),Q=document.body.dataset.storeAssets,k=new Image;k.fetchpriority="low";let l=null,A=0,h=0;window.SteamDB.RequirePageScreenshotViewer(te,!0),se(),i.parentNode.addEventListener("click",oe),i.addEventListener("pointerenter",ce,{passive:!0}),i.addEventListener("pointerleave",ae,{passive:!0}),document.body.addEventListener("touchstart",re,{passive:!0}),window.SteamDB.BindHover=e=>z(e.querySelectorAll(W)),window.SteamDB.HideHoverIfAny=f,window.SteamDB.OnExtensionUserdataLoaded(()=>{Y=!1});function oe(e){e.target.classList.contains("hover_mobile")&&(document.documentElement.classList.remove("js-hover-shown"),i.parentNode.classList.add("hover_hiding"),i.parentNode.addEventListener("transitionend",f,{once:!0}))}let w=null,g=null,c=null,C=!1,V=0;function re(e){if(e.touches.length!==1)return;const t=e.target.closest(".app, #js-hover");if(t){if(C=t.id==="js-hover",C)V=Date.now(),t.classList.add("hover_dragging");else{const n=K(t);if(n!==null&&n.scrollLeft!==0)return}c=t,w=g=e.touches.item(0),document.body.addEventListener("touchmove",G,{passive:!0}),document.body.addEventListener("touchend",q,{passive:!0})}}function G(e){const t=e.touches.item(0),n=t.screenX-w.screenX,o=t.screenY-w.screenY;if(C){g=t,i.scrollTop<1?c.style.transform=`translate3d(0, ${Math.max(0,o)}px, 0)`:w=t;return}if(t.screenX<g.screenX||Math.abs(o/n)>=.3){c=null,q();return}g=t}function q(){if(document.body.removeEventListener("touchmove",G),document.body.removeEventListener("touchend",q),c!==null){if(C){c.classList.remove("hover_dragging");const e=g.screenY-w.screenY,t=i.offsetHeight;e>t/2||Date.now()-V<180&&e>50?(document.documentElement.classList.remove("js-hover-shown"),i.parentNode.classList.add("hover_hiding"),c.style.transform=`translate3d(0, ${Math.max(0,t)}px, 0)`,c.addEventListener("transitionend",function(){f(),this.style.transform=""},{once:!0})):c.style.transform="";return}if(g.screenX-w.screenX>100){const e="app",t=+c.dataset.appid;let n;if(e==="app"&&(n=H.get(t)),n)return i.appendChild(n),B(n,null);Z(e,t,null)}c=null}}function K(e,t){return e===null||t>8?null:e.scrollWidth>e.clientWidth?e:K(e.parentNode,t+1)}function se(){const e=typeof $=="function"&&typeof $.fn=="object"&&typeof $.fn.dataTable=="function";let t=e?[]:document.querySelectorAll(W);e&&$($.fn.dataTable.tables()).each(function(){t=$(this).DataTable().table().rows(W).nodes().reduce(function(o,r){return o.push(r),o},t),$(this).on("draw.dt",f)}),z(t)}function z(e){for(const t of e)t.addEventListener("pointerenter",J,{passive:!0}),t.addEventListener("pointerleave",ie,{passive:!0})}function J(e){if(e.pointerType!=="mouse"||window.matchMedia("(max-width: 980px)").matches)return;if(d){L=e;return}const t="app",n=+e.target.dataset.appid;let o;if(t==="app"&&(o=H.get(n)),o)return i.appendChild(o),B(o,e.target);f(),T=setTimeout(()=>{Z(t,n,e.target)},ne)}function Z(e,t,n){let o;e==="app"&&(o=`/api/RenderAppHover/?appid=${t}`),v=new AbortController,fetch(o,{headers:{Accept:"text/html","X-Requested-With":"XMLHttpRequest"},signal:v.signal}).then(r=>{if(!r.ok){const s=new Error(`HTTP ${r.status}`);throw s.name="ServerError",s}return r.text()}).then(r=>{v=null,i.insertAdjacentHTML("beforeend",r);const s=i.firstChild;if(s){if(e==="app"){H.set(t,s),de(t,s);const a=s.querySelector(".js-open-screenshot-viewer");if(a&&a.dataset.screenshots){const x=a.dataset.screenshots.split(","),X=s.querySelector(".hover_title").textContent;te(a.dataset.appid,X,a,x)}}B(s,n)}}).catch(r=>{if(!(r.name==="AbortError"||r.name==="ServerError"))throw r})}function f(){if(L=null,T&&(clearTimeout(T),T=null),d&&(clearTimeout(d),d=null),v&&(v.abort(),v=null),b&&(b.destroy(),b=null),E){i.scrollTop=0,i.hidden=!0,i.style.transform="",i.parentNode.classList.remove("hover_mobile","hover_hiding"),document.documentElement.classList.remove("js-hover-shown");const e=E.querySelector("video");e&&(e.src="",e.remove()),E.remove(),E=null}}function ie(e){e.pointerType==="mouse"&&(L=null,!d&&(i.contains(e.relatedTarget)||(d=setTimeout(le,100))))}function le(){const e=L;f(),e&&J(e)}function ce(){clearTimeout(d),d=null,L=null}function ae(e){e.pointerType==="mouse"&&f()}function B(e,t){const n=e.querySelector(".hover_video");if(n){const p=document.createElement("video");p.autoplay=!0,p.muted=!0,p.loop=!0,p.playsInline=!0;let F=n.dataset.src;p.canPlayType('video/webm; codecs="vp8, vorbis"')!=="probably"&&(F=F.replace(/\.webm$/,".mp4")),p.src=F,n.appendChild(p)}if(t===null&&(i.parentNode.classList.add("hover_mobile"),document.documentElement.classList.add("js-hover-shown"),"CloseWatcher"in window&&(b=new window.CloseWatcher,b.addEventListener("close",f))),E=e,i.hidden=!1,t===null)return;const o=t.getBoundingClientRect(),r=document.documentElement.scrollTop,s=o.top+r,a=o.bottom+r,x=o.left+document.documentElement.scrollLeft,X=document.documentElement.clientWidth,N=document.documentElement.clientHeight,P=i.offsetWidth,D=i.offsetHeight,ue=X-(x+o.width+P),U=x-P;let S=0;U<0&&ue<0?(i.style.left=o.right-P+"px",s+D>N+r&&s-D>=r?S=s-D:S=a):(U<0?i.style.left=x+o.width+"px":i.style.left=U+"px",s+D>N+r?S=N+r-D:S=s),S<1?i.style.top=0:i.style.top=S+"px"}function y(e){h+=e,h<0?h=l.length-1:h%=l.length;let t=l[h];if(t.startsWith("https://")||(t=`${Q}apps/${A}/${t}`),u.querySelector(".screenshot-contain").style.backgroundImage=`url(${encodeURI(t)})`,u.querySelector(".screenshot-index").textContent=`${h+1} of ${l.length}`,u.querySelector(".screenshot-open").href=t,l.length>1){e===0&&(e=1);let n=h+e;n<0?n=l.length-1:n%=l.length,t=l[n],t.startsWith("https://")||(t=`${Q}apps/${A}/${t}`),k.src=t}}function ee(e){e.key==="ArrowLeft"?(e.preventDefault(),y(-1)):e.key==="ArrowRight"||e.key===" "?(e.preventDefault(),y(1)):e.key==="Escape"&&m===null&&(e.preventDefault(),_())}function _(){document.documentElement.classList.remove("js-screenshots-shown"),document.removeEventListener("keydown",ee),l=null,k.src="/static/p.gif",m&&(m.destroy(),m=null)}u.querySelector(".screenshot-prev").addEventListener("click",e=>{e.preventDefault(),y(-1)}),u.querySelector(".screenshot-next").addEventListener("click",e=>{e.preventDefault(),y(1)}),u.querySelector(".screenshot-close").addEventListener("click",e=>{e.preventDefault(),_()}),u.querySelector(".screenshot-contain").addEventListener("click",e=>{e.preventDefault(),y(e.pageX/document.documentElement.clientWidth>=.5?1:-1)});function te(e,t,n,o){const r=s=>{const a=u.querySelector(".screenshot-name");a.textContent=`SteamDB \u2014 ${t}`,a.href=`/app/${e}/`,h=s,A=e,l=o,y(0),document.documentElement.classList.add("js-screenshots-shown"),document.addEventListener("keydown",ee),"CloseWatcher"in window&&(m=new window.CloseWatcher,m.addEventListener("close",_))};return n&&n.addEventListener("click",s=>{s.preventDefault(),r(0)}),{open:r}}function de(e,t){if(Y)return;const n=t.querySelector(".hover_wishlist"),o=t.querySelector(".hover_follow"),r=t.querySelector(".hover_ignore");window.SteamDB.OwnedApps.has(e)?t.querySelector(".hover_owned").hidden=!1:n&&(window.SteamDB.WishedApps.has(e)&&j(n,!0),n.hidden=!1,n.addEventListener("click",s=>{s.preventDefault(),I(n),O(e,window.SteamDB.WishedApps.has(e)?"StoreWishlistRemove":"StoreWishlistAdd")})),o&&(window.SteamDB.FollowedApps.has(e)&&M(o,!0),o.hidden=!1,o.addEventListener("click",s=>{s.preventDefault(),I(o),O(e,window.SteamDB.FollowedApps.has(e)?"StoreUnfollow":"StoreFollow")})),r&&(window.SteamDB.IgnoredApps.has(e)&&R(r,!0),r.hidden=!1,r.addEventListener("click",s=>{s.preventDefault(),I(r),O(e,window.SteamDB.IgnoredApps.has(e)?"StoreUnignore":"StoreIgnore")}))}function I(e){e.innerHTML='<span class="loader"></span>'}function O(e,t){window.postMessage({type:"steamdb:extension-query",contentScriptQuery:t,appid:e},window.location.origin)}function j(e,t){e&&(e.classList.toggle("wished",t),e.textContent=t?"On Wishlist":"Wishlist")}function M(e,t){e&&(e.classList.toggle("followed",t),e.textContent=t?"Unfollow":"Follow")}function R(e,t){e&&(e.classList.toggle("ignored",t),e.textContent=t?"Unignore":"Ignore")}if("BroadcastChannel"in window)try{new BroadcastChannel("steamdb-extension").addEventListener("message",t=>{if(!(!t||t.origin!==window.location.origin)&&t.data&&t.data.type==="steamdb:extension-response"){if(!t.data.response||!t.data.response.success||!t.data.request.appid)return;const n=H.get(t.data.request.appid);if(!n)return;const o=n.querySelector(".hover_wishlist"),r=n.querySelector(".hover_follow"),s=n.querySelector(".hover_ignore");switch(t.data.request.contentScriptQuery){case"StoreWishlistAdd":j(o,!0);break;case"StoreWishlistRemove":j(o,!1);break;case"StoreFollow":M(r,!0);break;case"StoreUnfollow":M(r,!1);break;case"StoreIgnore":R(s,!0);break;case"StoreUnignore":R(s,!1);break}}})}catch{}})();
